module.exports=[82280,e=>e.a(async(t,r)=>{try{var i=e.i(29229),a=e.i(88707),n=e.i(78156),s=e.i(89722),p=e.i(56732),o=e.i(3781),d=t([i,a,n,s]);async function u(e){try{let t=await a.db.select().from(n.partners).where((0,s.and)((0,s.eq)(n.partners.id,e.partnerId),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).limit(1);if(0===t.length)return{success:!1,error:"Partner not found or inactive"};if((await a.db.select().from(n.users).where((0,s.and)((0,s.eq)(n.users.email,e.email),(0,s.eq)(n.users.isDeleted,!1))).limit(1)).length>0)return{success:!1,error:"Email already exists"};let r=await a.db.select().from(n.roles).where((0,s.eq)(n.roles.name,"partner")).limit(1);if(0===r.length)return{success:!1,error:"Partner role not found"};let d=e.password||function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*",t="";t+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],t+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],t+="0123456789"[Math.floor(10*Math.random())],t+="!@#$%^&*"[Math.floor(8*Math.random())];for(let r=t.length;r<12;r++)t+=e[Math.floor(Math.random()*e.length)];return t.split("").sort(()=>Math.random()-.5).join("")}(),u=await i.default.hash(d,12),l=!e.password,c=await a.db.insert(n.users).values({name:e.name,email:e.email,phone:e.phone||null,password:u,roleId:r[0].id,userType:"partner",partnerId:e.partnerId,languagePreference:e.language||"en",isActive:!0,isDeleted:!1,emailVerifiedAt:new Date,createdAt:new Date}).returning();if(!1!==e.sendWelcomeEmail&&l)try{await p.default.sendWelcomeEmail(e.email,e.name,d,e.language||"en"),o.logger.info("Welcome email sent",{email:e.email,userId:c[0].id})}catch(t){o.logger.error("Failed to send welcome email",{error:t,email:e.email})}return o.logger.info("Partner user created",{userId:c[0].id,email:e.email,partnerId:e.partnerId,passwordProvided:!l}),{success:!0,user:{id:c[0].id,name:c[0].name,email:c[0].email,phone:c[0].phone,partnerId:c[0].partnerId,languagePreference:c[0].languagePreference,createdAt:c[0].createdAt},password:d,temporaryPassword:l?d:void 0}}catch(t){return o.logger.error("Error creating partner user",{error:t,input:e}),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}[i,a,n,s]=d.then?(await d)():d,e.s(["createPartnerUser",()=>u]),r()}catch(e){r(e)}},!1),59793,e=>e.a(async(t,r)=>{try{var i=e.i(18879),a=e.i(11797),n=e.i(88707),s=e.i(78156),p=e.i(89722),o=e.i(85278),d=e.i(3781),u=e.i(97010),l=t([i,a,n,s,p,o,u]);async function c(e,t){if("GET"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return(0,o.sendErrorResponse)(t,{message:"Authorization header missing or invalid",code:"AUTHENTICATION_ERROR",statusCode:401});let l=r.substring(7),{userId:c}=await a.authService.verifyToken(l),m=await a.authService.getUserProfile(c);if("admin"!==m.userType)return(0,o.sendErrorResponse)(t,{message:"Access denied - Admin required",code:"AUTHORIZATION_ERROR",statusCode:403});let h=parseInt(e.query.id);if(isNaN(h))return(0,o.sendErrorResponse)(t,{message:"Invalid partner ID",code:"VALIDATION_ERROR",statusCode:400});if("GET"===e.method){let r=await n.db.select({id:s.partnerPickupOptions.id,pickupOptionTypeId:s.partnerPickupOptions.pickupOptionTypeId,pickupOptionName:s.pickupOptionTypes.name,pickupOptionNameAr:s.pickupOptionTypes.nameAr,pickupOptionDescription:s.pickupOptionTypes.description,pickupOptionDescriptionAr:s.pickupOptionTypes.descriptionAr,requiresServiceSelection:s.pickupOptionTypes.requiresServiceSelection,createdAt:s.partnerPickupOptions.createdAt}).from(s.partnerPickupOptions).leftJoin(s.pickupOptionTypes,(0,p.eq)(s.partnerPickupOptions.pickupOptionTypeId,s.pickupOptionTypes.id)).where((0,p.and)((0,p.eq)(s.partnerPickupOptions.partnerId,h),(0,p.eq)(s.partnerPickupOptions.isActive,!0),(0,p.eq)(s.partnerPickupOptions.isDeleted,!1))).orderBy(s.pickupOptionTypes.name);return d.logger.apiResponse(e.method,e.url,200,0,c,e.headers["x-request-id"]),(0,o.sendSuccessResponse)(t,{pickupOptions:r,total:r.length})}if("POST"===e.method){let r=u.z.object({pickupOptionTypeId:u.z.number().int().positive()}).parse(e.body);return await i.partnerService.assignPartnerPickupOption({partnerId:h,pickupOptionTypeId:r.pickupOptionTypeId},c),d.logger.apiResponse(e.method,e.url,201,0,c,e.headers["x-request-id"]),(0,o.sendSuccessResponse)(t,{message:"Pickup option assigned successfully"},201)}if("DELETE"===e.method){let r=u.z.object({pickupOptionTypeId:u.z.number().int().positive()}).parse(e.body);return await n.db.update(s.partnerPickupOptions).set({isDeleted:!0,updatedAt:new Date,updatedById:c}).where((0,p.and)((0,p.eq)(s.partnerPickupOptions.partnerId,h),(0,p.eq)(s.partnerPickupOptions.pickupOptionTypeId,r.pickupOptionTypeId),(0,p.eq)(s.partnerPickupOptions.isActive,!0),(0,p.eq)(s.partnerPickupOptions.isDeleted,!1))),d.logger.apiResponse(e.method,e.url,200,0,c,e.headers["x-request-id"]),(0,o.sendSuccessResponse)(t,{message:"Pickup option removed successfully"})}}catch(i){let r=(0,o.handleApiError)(i);return d.logger.error("Admin partner pickup options API error",{error:r.message,code:r.code,requestId:e.headers["x-request-id"]}),(0,o.sendErrorResponse)(t,r)}}[i,a,n,s,p,o,u]=l.then?(await l)():l,e.s(["default",()=>c]),r()}catch(e){r(e)}},!1),3228,e=>e.a(async(t,r)=>{try{var i=e.i(89304),a=e.i(36438),n=e.i(90950),s=e.i(17885),p=e.i(59793),o=e.i(8911),d=e.i(95011),u=e.i(40430),l=t([p]);[p]=l.then?(await l)():l;let m=(0,s.hoist)(p,"default"),h=(0,s.hoist)(p,"config"),g=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/admin/partners/[id]/pickup-options",pathname:"/api/admin/partners/[id]/pickup-options",bundlePath:"",filename:""},userland:p,distDir:".next",relativeProjectDir:""});async function c(e,t,r){g.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/admin/partners/[id]/pickup-options";a=a.replace(/\/index$/,"")||"/";let n=await g.prepare(e,t,{srcPage:a});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:s,params:p,prerenderManifest:l,routerServerContext:c}=n;try{let r=e.method||"GET",i=(0,o.getTracer)(),n=i.getActiveScopeSpan(),u=g.instrumentationOnRequestError.bind(g),m=async n=>g.render(e,t,{query:{...s,...p},params:p,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:g.isDev,page:"/api/admin/partners/[id]/pickup-options",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${r} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${a}`)});n?await m(n):await i.withPropagatedContext(e.headers,()=>i.trace(d.BaseServerSpan.handleRequest,{spanName:`${r} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(g.isDev)throw e;(0,i.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,h,"default",0,m,"handler",()=>c]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_32ed40da._.js.map