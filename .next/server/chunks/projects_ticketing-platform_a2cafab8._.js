module.exports=[82280,e=>e.a(async(r,t)=>{try{var a=e.i(29229),n=e.i(88707),s=e.i(78156),i=e.i(89722),o=e.i(56732),d=e.i(3781),l=r([a,n,s,i]);async function u(e){try{let r=await n.db.select().from(s.partners).where((0,i.and)((0,i.eq)(s.partners.id,e.partnerId),(0,i.eq)(s.partners.isActive,!0),(0,i.eq)(s.partners.isDeleted,!1))).limit(1);if(0===r.length)return{success:!1,error:"Partner not found or inactive"};if((await n.db.select().from(s.users).where((0,i.and)((0,i.eq)(s.users.email,e.email),(0,i.eq)(s.users.isDeleted,!1))).limit(1)).length>0)return{success:!1,error:"Email already exists"};let t=await n.db.select().from(s.roles).where((0,i.eq)(s.roles.name,"partner")).limit(1);if(0===t.length)return{success:!1,error:"Partner role not found"};let l=e.password||function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*",r="";r+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],r+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],r+="0123456789"[Math.floor(10*Math.random())],r+="!@#$%^&*"[Math.floor(8*Math.random())];for(let t=r.length;t<12;t++)r+=e[Math.floor(Math.random()*e.length)];return r.split("").sort(()=>Math.random()-.5).join("")}(),u=await a.default.hash(l,12),c=!e.password,p=await n.db.insert(s.users).values({name:e.name,email:e.email,phone:e.phone||null,password:u,roleId:t[0].id,userType:"partner",partnerId:e.partnerId,languagePreference:e.language||"en",isActive:!0,isDeleted:!1,emailVerifiedAt:new Date,createdAt:new Date}).returning();if(!1!==e.sendWelcomeEmail&&c)try{await o.default.sendWelcomeEmail(e.email,e.name,l,e.language||"en"),d.logger.info("Welcome email sent",{email:e.email,userId:p[0].id})}catch(r){d.logger.error("Failed to send welcome email",{error:r,email:e.email})}return d.logger.info("Partner user created",{userId:p[0].id,email:e.email,partnerId:e.partnerId,passwordProvided:!c}),{success:!0,user:{id:p[0].id,name:p[0].name,email:p[0].email,phone:p[0].phone,partnerId:p[0].partnerId,languagePreference:p[0].languagePreference,createdAt:p[0].createdAt},password:l,temporaryPassword:c?l:void 0}}catch(r){return d.logger.error("Error creating partner user",{error:r,input:e}),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}[a,n,s,i]=l.then?(await l)():l,e.s(["createPartnerUser",()=>u]),t()}catch(e){t(e)}},!1),11748,e=>e.a(async(r,t)=>{try{var a=e.i(18879),n=e.i(11797),s=e.i(85278),i=e.i(3781),o=r([a,n,s]);async function d(e,r){if("GET"!==e.method)return r.status(405).json({message:"Method not allowed"});try{let t=e.headers.authorization;if(!t||!t.startsWith("Bearer "))return(0,s.sendErrorResponse)(r,{message:"Authorization header missing or invalid",code:"AUTHENTICATION_ERROR",statusCode:401});let o=t.substring(7),{userId:d}=await n.authService.verifyToken(o),l=await n.authService.getUserProfile(d);if("admin"!==l.userType)return(0,s.sendErrorResponse)(r,{message:"Access denied - Admin required",code:"AUTHORIZATION_ERROR",statusCode:403});let u=parseInt(e.query.id);if(isNaN(u))return(0,s.sendErrorResponse)(r,{message:"Invalid partner ID",code:"VALIDATION_ERROR",statusCode:400});i.logger.apiRequest(e.method,e.url,{userId:d},void 0,e.headers["x-request-id"]);let c=parseInt(e.query.page)||1,p=parseInt(e.query.limit)||10,m=e.query.search,h=e.query.sortBy||"name",g=["name","createdAt","distance"].includes(h)?h:"name",f=e.query.sortOrder||"asc",w=await a.partnerService.getBranches({partnerId:u,page:c,limit:p,search:m,sortBy:g,sortOrder:f,radiusKm:10});return i.logger.apiResponse(e.method,e.url,200,0,d,e.headers["x-request-id"]),(0,s.sendSuccessResponse)(r,w)}catch(a){let t=(0,s.handleApiError)(a);return i.logger.error("Admin partner branches API error",{error:t.message,code:t.code,requestId:e.headers["x-request-id"]}),(0,s.sendErrorResponse)(r,t)}}[a,n,s]=o.then?(await o)():o,e.s(["default",()=>d]),t()}catch(e){t(e)}},!1),25336,e=>e.a(async(r,t)=>{try{var a=e.i(89304),n=e.i(36438),s=e.i(90950),i=e.i(17885),o=e.i(11748),d=e.i(8911),l=e.i(95011),u=e.i(40430),c=r([o]);[o]=c.then?(await c)():c;let m=(0,i.hoist)(o,"default"),h=(0,i.hoist)(o,"config"),g=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/admin/partners/[id]/branches",pathname:"/api/admin/partners/[id]/branches",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,r,t){g.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/admin/partners/[id]/branches";n=n.replace(/\/index$/,"")||"/";let s=await g.prepare(e,r,{srcPage:n});if(!s){r.statusCode=400,r.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve());return}let{query:i,params:o,prerenderManifest:c,routerServerContext:p}=s;try{let t=e.method||"GET",a=(0,d.getTracer)(),s=a.getActiveScopeSpan(),u=g.instrumentationOnRequestError.bind(g),m=async s=>g.render(e,r,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:g.isDev,page:"/api/admin/partners/[id]/branches",internalRevalidate:null==p?void 0:p.revalidate,onError:(...r)=>u(e,...r)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${t} ${i}`;s.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),s.updateName(e)}else s.updateName(`${t} ${n}`)});s?await m(s):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${t} ${n}`,kind:d.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},m))}catch(e){if(g.isDev)throw e;(0,a.sendError)(r,500,"Internal Server Error")}finally{null==t.waitUntil||t.waitUntil.call(t,Promise.resolve())}}e.s(["config",0,h,"default",0,m,"handler",()=>p]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_a2cafab8._.js.map