module.exports=[82280,e=>e.a(async(r,t)=>{try{var a=e.i(29229),s=e.i(88707),i=e.i(78156),n=e.i(89722),o=e.i(56732),d=e.i(3781),l=r([a,s,i,n]);async function c(e){try{let r=await s.db.select().from(i.partners).where((0,n.and)((0,n.eq)(i.partners.id,e.partnerId),(0,n.eq)(i.partners.isActive,!0),(0,n.eq)(i.partners.isDeleted,!1))).limit(1);if(0===r.length)return{success:!1,error:"Partner not found or inactive"};if((await s.db.select().from(i.users).where((0,n.and)((0,n.eq)(i.users.email,e.email),(0,n.eq)(i.users.isDeleted,!1))).limit(1)).length>0)return{success:!1,error:"Email already exists"};let t=await s.db.select().from(i.roles).where((0,n.eq)(i.roles.name,"partner")).limit(1);if(0===t.length)return{success:!1,error:"Partner role not found"};let l=e.password||function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*",r="";r+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],r+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],r+="0123456789"[Math.floor(10*Math.random())],r+="!@#$%^&*"[Math.floor(8*Math.random())];for(let t=r.length;t<12;t++)r+=e[Math.floor(Math.random()*e.length)];return r.split("").sort(()=>Math.random()-.5).join("")}(),c=await a.default.hash(l,12),u=!e.password,p=await s.db.insert(i.users).values({name:e.name,email:e.email,phone:e.phone||null,password:c,roleId:t[0].id,userType:"partner",partnerId:e.partnerId,languagePreference:e.language||"en",isActive:!0,isDeleted:!1,emailVerifiedAt:new Date,createdAt:new Date}).returning();if(!1!==e.sendWelcomeEmail&&u)try{await o.default.sendWelcomeEmail(e.email,e.name,l,e.language||"en"),d.logger.info("Welcome email sent",{email:e.email,userId:p[0].id})}catch(r){d.logger.error("Failed to send welcome email",{error:r,email:e.email})}return d.logger.info("Partner user created",{userId:p[0].id,email:e.email,partnerId:e.partnerId,passwordProvided:!u}),{success:!0,user:{id:p[0].id,name:p[0].name,email:p[0].email,phone:p[0].phone,partnerId:p[0].partnerId,languagePreference:p[0].languagePreference,createdAt:p[0].createdAt},password:l,temporaryPassword:u?l:void 0}}catch(r){return d.logger.error("Error creating partner user",{error:r,input:e}),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}[a,s,i,n]=l.then?(await l)():l,e.s(["createPartnerUser",()=>c]),t()}catch(e){t(e)}},!1),47496,e=>e.a(async(r,t)=>{try{var a=e.i(18879),s=e.i(11797),i=e.i(88707),n=e.i(78156),o=e.i(89722),d=e.i(85278),l=e.i(3781),c=e.i(97010),u=r([a,s,i,n,o,d,c]);async function p(e,r){if("GET"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method)return r.status(405).json({message:"Method not allowed"});try{let t=e.headers.authorization;if(!t||!t.startsWith("Bearer "))return(0,d.sendErrorResponse)(r,{message:"Authorization header missing or invalid",code:"AUTHENTICATION_ERROR",statusCode:401});let u=t.substring(7),{userId:p}=await s.authService.verifyToken(u),g=await s.authService.getUserProfile(p);if("admin"!==g.userType)return(0,d.sendErrorResponse)(r,{message:"Access denied - Admin required",code:"AUTHORIZATION_ERROR",statusCode:403});let m=parseInt(e.query.id);if(isNaN(m))return(0,d.sendErrorResponse)(r,{message:"Invalid partner ID",code:"VALIDATION_ERROR",statusCode:400});if(l.logger.apiRequest(e.method,e.url,{userId:p},void 0,e.headers["x-request-id"]),"GET"===e.method){let t=await i.db.select({id:n.partnerCategories.id,categoryId:n.partnerCategories.categoryId,categoryName:n.categories.name,categoryDescription:n.categories.description,categoryIcon:n.categories.iconUrl,createdAt:n.partnerCategories.createdAt}).from(n.partnerCategories).leftJoin(n.categories,(0,o.eq)(n.partnerCategories.categoryId,n.categories.id)).where((0,o.and)((0,o.eq)(n.partnerCategories.partnerId,m),(0,o.eq)(n.partnerCategories.isActive,!0),(0,o.eq)(n.partnerCategories.isDeleted,!1))).orderBy(n.categories.name);return l.logger.apiResponse(e.method,e.url,200,0,p,e.headers["x-request-id"]),(0,d.sendSuccessResponse)(r,{categories:t,total:t.length})}if("POST"===e.method){let t=c.z.object({categoryId:c.z.number().int().positive()}).parse(e.body);return await a.partnerService.assignPartnerCategory({partnerId:m,categoryId:t.categoryId},p),l.logger.apiResponse(e.method,e.url,201,0,p,e.headers["x-request-id"]),(0,d.sendSuccessResponse)(r,{message:"Category assigned successfully"},201)}if("DELETE"===e.method){let t=c.z.object({categoryId:c.z.number().int().positive()}).parse(e.body);return await i.db.update(n.partnerCategories).set({isDeleted:!0,updatedAt:new Date,updatedById:p}).where((0,o.and)((0,o.eq)(n.partnerCategories.partnerId,m),(0,o.eq)(n.partnerCategories.categoryId,t.categoryId),(0,o.eq)(n.partnerCategories.isActive,!0),(0,o.eq)(n.partnerCategories.isDeleted,!1))),l.logger.apiResponse(e.method,e.url,200,0,p,e.headers["x-request-id"]),(0,d.sendSuccessResponse)(r,{message:"Category removed successfully"})}}catch(a){let t=(0,d.handleApiError)(a);return l.logger.error("Admin partner categories API error",{error:t.message,code:t.code,requestId:e.headers["x-request-id"]}),(0,d.sendErrorResponse)(r,t)}}[a,s,i,n,o,d,c]=u.then?(await u)():u,e.s(["default",()=>p]),t()}catch(e){t(e)}},!1),35342,e=>e.a(async(r,t)=>{try{var a=e.i(89304),s=e.i(36438),i=e.i(90950),n=e.i(17885),o=e.i(47496),d=e.i(8911),l=e.i(95011),c=e.i(40430),u=r([o]);[o]=u.then?(await u)():u;let g=(0,n.hoist)(o,"default"),m=(0,n.hoist)(o,"config"),h=new i.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/admin/partners/[id]/categories",pathname:"/api/admin/partners/[id]/categories",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,r,t){h.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/admin/partners/[id]/categories";s=s.replace(/\/index$/,"")||"/";let i=await h.prepare(e,r,{srcPage:s});if(!i){r.statusCode=400,r.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve());return}let{query:n,params:o,prerenderManifest:u,routerServerContext:p}=i;try{let t=e.method||"GET",a=(0,d.getTracer)(),i=a.getActiveScopeSpan(),c=h.instrumentationOnRequestError.bind(h),g=async i=>h.render(e,r,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:h.isDev,page:"/api/admin/partners/[id]/categories",internalRevalidate:null==p?void 0:p.revalidate,onError:(...r)=>c(e,...r)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;i.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),i.updateName(e)}else i.updateName(`${t} ${s}`)});i?await g(i):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${t} ${s}`,kind:d.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},g))}catch(e){if(h.isDev)throw e;(0,a.sendError)(r,500,"Internal Server Error")}finally{null==t.waitUntil||t.waitUntil.call(t,Promise.resolve())}}e.s(["config",0,m,"default",0,g,"handler",()=>p]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_2ef91dec._.js.map