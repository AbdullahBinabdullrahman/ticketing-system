module.exports=[60901,e=>e.a(async(r,t)=>{try{var s=e.i(11797),i=e.i(88707),a=e.i(78156),n=e.i(89722),o=e.i(85278),d=e.i(3781),l=r([s,i,a,n,o]);async function u(e,r){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))throw new o.AppError("Authentication required",401,o.ErrorCodes.UNAUTHORIZED);let t=r.substring(7),{userId:i}=await s.authService.verifyToken(t),a=await s.authService.getUserProfile(i);return e.user=a,e.userId=a.id,e.roleId=a.roleId,a}catch(r){throw d.logger.error("Authentication failed",{error:r instanceof Error?r.message:"Unknown error",path:e.url}),r}}async function c(e,r,t){try{e.user&&e.roleId||await u(e,r);let s=e.roleId,l=await i.db.select().from(a.rolePermissions).innerJoin(a.permissions,(0,n.eq)(a.permissions.id,a.rolePermissions.permissionId)).where((0,n.and)((0,n.eq)(a.rolePermissions.roleId,s),(0,n.eq)(a.permissions.name,t),(0,n.eq)(a.rolePermissions.isActive,!0),(0,n.eq)(a.rolePermissions.isDeleted,!1),(0,n.eq)(a.permissions.isActive,!0),(0,n.eq)(a.permissions.isDeleted,!1))).limit(1);if(0===l.length)throw new o.AppError(`Permission denied: ${t} required`,403,o.ErrorCodes.FORBIDDEN);d.logger.info("Permission check passed",{userId:e.userId,roleId:s,permission:t})}catch(r){throw d.logger.error("Permission check failed",{error:r instanceof Error?r.message:"Unknown error",userId:e.userId,permission:t,path:e.url}),r}}[s,i,a,n,o]=l.then?(await l)():l,e.s(["requireAuth",()=>u,"requirePermission",()=>c]),t()}catch(e){t(e)}},!1),27871,e=>e.a(async(r,t)=>{try{var s=e.i(97010),i=e.i(11797),a=e.i(60901),n=e.i(85278),o=e.i(3781),d=r([s,i,a,n]);[s,i,a,n]=d.then?(await d)():d;let u=s.z.object({currentPassword:s.z.string().min(1,"Current password is required"),newPassword:s.z.string().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number")});async function l(e,r){if("PUT"!==e.method)return r.status(405).json({message:"Method not allowed"});try{let t=await (0,a.requireAuth)(e,r),s=u.parse(e.body);return await i.authService.changePassword(t.id,{currentPassword:s.currentPassword,newPassword:s.newPassword}),o.logger.apiResponse(e.method,e.url,200,0,t.id,e.headers["x-request-id"]),(0,n.sendSuccessResponse)(r,{message:"Password changed successfully"})}catch(s){let t=(0,n.handleApiError)(s);return o.logger.error("Change password API error",{error:t.message,code:t.code,requestId:e.headers["x-request-id"]}),(0,n.sendErrorResponse)(r,t)}}e.s(["default",0,l]),t()}catch(e){t(e)}},!1),98209,e=>e.a(async(r,t)=>{try{var s=e.i(89304),i=e.i(36438),a=e.i(90950),n=e.i(17885),o=e.i(27871),d=e.i(8911),l=e.i(95011),u=e.i(40430),c=r([o]);[o]=c.then?(await c)():c;let h=(0,n.hoist)(o,"default"),w=(0,n.hoist)(o,"config"),m=new a.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/partner/profile/change-password",pathname:"/api/partner/profile/change-password",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,r,t){m.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/partner/profile/change-password";i=i.replace(/\/index$/,"")||"/";let a=await m.prepare(e,r,{srcPage:i});if(!a){r.statusCode=400,r.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve());return}let{query:n,params:o,prerenderManifest:c,routerServerContext:p}=a;try{let t=e.method||"GET",s=(0,d.getTracer)(),a=s.getActiveScopeSpan(),u=m.instrumentationOnRequestError.bind(m),h=async a=>m.render(e,r,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:m.isDev,page:"/api/partner/profile/change-password",internalRevalidate:null==p?void 0:p.revalidate,onError:(...r)=>u(e,...r)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;a.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${i}`)});a?await h(a):await s.withPropagatedContext(e.headers,()=>s.trace(l.BaseServerSpan.handleRequest,{spanName:`${t} ${i}`,kind:d.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},h))}catch(e){if(m.isDev)throw e;(0,s.sendError)(r,500,"Internal Server Error")}finally{null==t.waitUntil||t.waitUntil.call(t,Promise.resolve())}}e.s(["config",0,w,"default",0,h,"handler",()=>p]),t()}catch(e){t(e)}},!1),88749,e=>{e.v(e=>Promise.resolve().then(()=>e(85278)))}];

//# sourceMappingURL=projects_ticketing-platform_723e3342._.js.map