module.exports=[18879,e=>e.a(async(r,t)=>{try{var a=e.i(88707),n=e.i(78156),s=e.i(89722),o=e.i(85278),i=e.i(3781),d=e.i(82280),c=r([a,n,s,o,d]);[a,n,s,o,d]=c.then?(await c)():c;let p=new class{async createPartner(e,r){try{i.logger.info("Creating new partner",{name:e.name,createdById:r});let t=await a.db.insert(n.partners).values({...e,createdById:r}).returning(),s={id:t[0].id,name:t[0].name,status:t[0].status||"active",logoUrl:t[0].logoUrl||void 0,contactEmail:t[0].contactEmail||void 0,contactPhone:t[0].contactPhone||void 0,createdAt:t[0].createdAt,updatedAt:t[0].updatedAt,branchesCount:0,categoriesCount:0,requestsCount:0,completedRequestsCount:0,averageRating:0};return i.logger.info("Partner created successfully",{partnerId:t[0].id,name:e.name}),s}catch(r){throw i.logger.error("Create partner failed",{error:r instanceof Error?r.message:"Unknown error",name:e.name}),r}}async createPartnerWithUser(e,r){try{i.logger.info("Creating partner with initial user",{partnerName:e.name,userEmail:e.userEmail,createdById:r});let t=await this.createPartner({name:e.name,contactEmail:e.contactEmail,contactPhone:e.contactPhone,logoUrl:e.logoUrl,status:e.status},r),a=await (0,d.createPartnerUser)({partnerId:t.id,name:e.userName,email:e.userEmail,phone:e.userPhone,password:e.userPassword,sendWelcomeEmail:e.sendWelcomeEmail});return a.success&&a.user||i.logger.error("User creation failed, rolling back partner",{partnerId:t.id,error:a.error}),i.logger.info("Partner created with initial user successfully",{partnerId:t.id,userId:a.user.id,emailSent:e.sendWelcomeEmail}),{partner:t,user:{id:a.user.id,email:a.user.email,temporaryPassword:a.temporaryPassword}}}catch(r){throw i.logger.error("Failed to create partner with user",{error:r instanceof Error?r.message:"Unknown error",partnerName:e.name,userEmail:e.userEmail}),r}}async updatePartner(e,r,t){try{i.logger.info("Updating partner",{partnerId:e,updatedById:t});let d=await a.db.update(n.partners).set({...r,updatedAt:new Date,updatedById:t}).where((0,s.and)((0,s.eq)(n.partners.id,e),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).returning();if(0===d.length)throw new o.AppError("Partner not found",404,o.ErrorCodes.PARTNER_NOT_FOUND);let c=await this.getPartnerWithDetails(e);return i.logger.info("Partner updated successfully",{partnerId:e}),c}catch(r){throw i.logger.error("Update partner failed",{error:r instanceof Error?r.message:"Unknown error",partnerId:e}),r}}async deletePartner(e,r){try{i.logger.info("Deleting partner",{partnerId:e,deletedById:r}),await a.db.update(n.partners).set({isDeleted:!0,updatedAt:new Date,updatedById:r}).where((0,s.and)((0,s.eq)(n.partners.id,e),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))),i.logger.info("Partner deleted successfully",{partnerId:e})}catch(r){throw i.logger.error("Delete partner failed",{error:r instanceof Error?r.message:"Unknown error",partnerId:e}),r}}async getPartners(e){try{let r;i.logger.info("Getting partners",{filters:e});let t=[(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1)];e.status&&t.push((0,s.eq)(n.partners.status,e.status)),e.search&&t.push((0,s.like)(n.partners.name,`%${e.search}%`)),e.categoryId&&t.push(s.sql`${n.partners.id} IN (SELECT partner_id FROM partner_categories WHERE category_id = ${e.categoryId})`);let o=await a.db.select({count:(0,s.count)()}).from(n.partners).where((0,s.and)(...t)),d=o[0]?.count||0,c=await a.db.select().from(n.partners).where((0,s.and)(...t)).orderBy("asc"===e.sortOrder?(0,s.asc)(n.partners[e.sortBy]):(0,s.desc)(n.partners[e.sortBy])).limit(e.limit).offset((e.page-1)*e.limit),p=c.map(e=>e.id);if(0===p.length)return{partners:[],total:0};let[l,u,h,g,m]=await Promise.all([a.db.select({partnerId:n.branches.partnerId,count:(0,s.count)()}).from(n.branches).where((0,s.and)((0,s.inArray)(n.branches.partnerId,p),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))).groupBy(n.branches.partnerId),a.db.select({partnerId:n.partnerCategories.partnerId,count:(0,s.count)()}).from(n.partnerCategories).where((0,s.and)((0,s.inArray)(n.partnerCategories.partnerId,p),(0,s.eq)(n.partnerCategories.isActive,!0),(0,s.eq)(n.partnerCategories.isDeleted,!1))).groupBy(n.partnerCategories.partnerId),a.db.select({partnerId:n.requests.partnerId,count:(0,s.count)()}).from(n.requests).where((0,s.and)((0,s.inArray)(n.requests.partnerId,p),s.sql`${n.requests.partnerId} IS NOT NULL`,(0,s.eq)(n.requests.isDeleted,!1))).groupBy(n.requests.partnerId),a.db.select({partnerId:n.requests.partnerId,count:(0,s.count)()}).from(n.requests).where((0,s.and)((0,s.inArray)(n.requests.partnerId,p),s.sql`${n.requests.partnerId} IS NOT NULL`,s.sql`${n.requests.status} = 'completed'::request_status_enum`,(0,s.eq)(n.requests.isDeleted,!1))).groupBy(n.requests.partnerId),a.db.select({partnerId:n.requests.partnerId,avgRating:s.sql`COALESCE(AVG(${n.requests.rating}), 0)`}).from(n.requests).where((0,s.and)((0,s.inArray)(n.requests.partnerId,p),s.sql`${n.requests.partnerId} IS NOT NULL`,s.sql`${n.requests.rating} IS NOT NULL`,(0,s.eq)(n.requests.isDeleted,!1))).groupBy(n.requests.partnerId)]),b=new Map(l.map(e=>[e.partnerId,Number(e.count)])),q=new Map(u.map(e=>[e.partnerId,Number(e.count)])),w=new Map(h.map(e=>[e.partnerId,Number(e.count)])),f=new Map(g.map(e=>[e.partnerId,Number(e.count)])),I=new Map(m.map(e=>[e.partnerId,Number(e.avgRating)||0]));if(e.includeBranches){let e=await a.db.select({id:n.branches.id,partnerId:n.branches.partnerId,name:n.branches.name,lat:n.branches.lat,lng:n.branches.lng,contactName:n.branches.contactName,phone:n.branches.phone,address:n.branches.address,radiusKm:n.branches.radiusKm,createdAt:n.branches.createdAt,updatedAt:n.branches.updatedAt}).from(n.branches).where((0,s.and)((0,s.inArray)(n.branches.partnerId,p),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))).orderBy((0,s.asc)(n.branches.name));for(let t of(r=new Map,e)){let e={id:t.id,partnerId:t.partnerId,partnerName:c.find(e=>e.id===t.partnerId)?.name||"",name:t.name,lat:parseFloat(t.lat||"0"),lng:parseFloat(t.lng||"0"),contactName:t.contactName||void 0,phone:t.phone||void 0,address:t.address||void 0,radiusKm:parseFloat(t.radiusKm||"10"),createdAt:t.createdAt,updatedAt:t.updatedAt,usersCount:0,requestsCount:0};r.has(t.partnerId)||r.set(t.partnerId,[]),r.get(t.partnerId).push(e)}}let A=c.map(e=>({id:e.id,name:e.name,status:e.status||"active",logoUrl:e.logoUrl||void 0,contactEmail:e.contactEmail||void 0,contactPhone:e.contactPhone||void 0,createdAt:e.createdAt,updatedAt:e.updatedAt,branchesCount:b.get(e.id)||0,categoriesCount:q.get(e.id)||0,requestsCount:w.get(e.id)||0,completedRequestsCount:f.get(e.id)||0,averageRating:I.get(e.id)||0,branches:r?r.get(e.id):void 0}));return i.logger.info("Partners retrieved successfully",{count:A.length,total:d,filters:e}),{partners:A,total:d}}catch(r){throw i.logger.error("Get partners failed",{error:r instanceof Error?r.message:"Unknown error",filters:e}),r}}async getPartnerWithDetails(e,r=!1){try{let t,i=await a.db.select().from(n.partners).where((0,s.and)((0,s.eq)(n.partners.id,e),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).limit(1);if(0===i.length)throw new o.AppError("Partner not found",404,o.ErrorCodes.PARTNER_NOT_FOUND);let d=await a.db.select({count:(0,s.count)()}).from(n.branches).where((0,s.and)((0,s.eq)(n.branches.partnerId,e),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))),c=await a.db.select({count:(0,s.count)()}).from(n.partnerCategories).where((0,s.and)((0,s.eq)(n.partnerCategories.partnerId,e),(0,s.eq)(n.partnerCategories.isActive,!0),(0,s.eq)(n.partnerCategories.isDeleted,!1))),p=await a.db.select({count:(0,s.count)()}).from(n.requests).where((0,s.and)((0,s.eq)(n.requests.partnerId,e),(0,s.eq)(n.requests.isActive,!0),(0,s.eq)(n.requests.isDeleted,!1))),l=await a.db.select({count:(0,s.count)()}).from(n.requests).where((0,s.and)((0,s.eq)(n.requests.partnerId,e),s.sql`${n.requests.status} = 'closed'::request_status_enum`,(0,s.eq)(n.requests.isActive,!0),(0,s.eq)(n.requests.isDeleted,!1))),u=await a.db.select({avgRating:s.sql`AVG(${n.requests.rating})`}).from(n.requests).where((0,s.and)((0,s.eq)(n.requests.partnerId,e),s.sql`${n.requests.status} = 'closed'::request_status_enum`,(0,s.eq)(n.requests.isActive,!0),(0,s.eq)(n.requests.isDeleted,!1)));return r&&(t=(await this.getBranches({partnerId:e,radiusKm:10,page:1,limit:100,sortBy:"name",sortOrder:"asc"})).branches),{id:i[0].id,name:i[0].name,status:i[0].status||"active",logoUrl:i[0].logoUrl||void 0,contactEmail:i[0].contactEmail||void 0,contactPhone:i[0].contactPhone||void 0,createdAt:i[0].createdAt,updatedAt:i[0].updatedAt,branchesCount:d[0]?.count||0,categoriesCount:c[0]?.count||0,requestsCount:p[0]?.count||0,completedRequestsCount:l[0]?.count||0,averageRating:u[0]?.avgRating||0,branches:t}}catch(r){throw i.logger.error("Get partner with details failed",{error:r instanceof Error?r.message:"Unknown error",partnerId:e}),r}}async createBranch(e,r){try{i.logger.info("Creating new branch",{name:e.name,partnerId:e.partnerId,createdById:r});let t=await a.db.select().from(n.partners).where((0,s.and)((0,s.eq)(n.partners.id,e.partnerId),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).limit(1);if(0===t.length)throw new o.AppError("Partner not found",404,o.ErrorCodes.PARTNER_NOT_FOUND);let d=await a.db.insert(n.branches).values({...e,lat:e.lat.toString(),lng:e.lng.toString(),radiusKm:e.radiusKm.toString(),createdById:r}).returning(),c={id:d[0].id,partnerId:d[0].partnerId,partnerName:t[0].name,name:d[0].name,lat:parseFloat(d[0].lat),lng:parseFloat(d[0].lng),contactName:d[0].contactName||void 0,phone:d[0].phone||void 0,address:d[0].address||void 0,radiusKm:parseFloat(d[0].radiusKm||"10"),createdAt:d[0].createdAt,updatedAt:d[0].updatedAt,usersCount:0,requestsCount:0};return i.logger.info("Branch created successfully",{branchId:d[0].id,name:e.name,partnerId:e.partnerId}),c}catch(r){throw i.logger.error("Create branch failed",{error:r instanceof Error?r.message:"Unknown error",name:e.name,partnerId:e.partnerId}),r}}async updateBranch(e,r,t){try{i.logger.info("Updating branch",{branchId:e,updatedById:t});let d={...r,updatedAt:new Date,updatedById:t};void 0!==r.lat&&(d.lat=r.lat.toString()),void 0!==r.lng&&(d.lng=r.lng.toString()),void 0!==r.radiusKm&&(d.radiusKm=r.radiusKm.toString());let c=await a.db.update(n.branches).set(d).where((0,s.and)((0,s.eq)(n.branches.id,e),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))).returning();if(0===c.length)throw new o.AppError("Branch not found",404,o.ErrorCodes.BRANCH_NOT_FOUND);let p=await this.getBranchWithDetails(e);return i.logger.info("Branch updated successfully",{branchId:e}),p}catch(r){throw i.logger.error("Update branch failed",{error:r instanceof Error?r.message:"Unknown error",branchId:e}),r}}async deleteBranch(e,r){try{i.logger.info("Deleting branch",{branchId:e,deletedById:r}),await a.db.update(n.branches).set({isDeleted:!0,updatedAt:new Date,updatedById:r}).where((0,s.and)((0,s.eq)(n.branches.id,e),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))),i.logger.info("Branch deleted successfully",{branchId:e})}catch(r){throw i.logger.error("Delete branch failed",{error:r instanceof Error?r.message:"Unknown error",branchId:e}),r}}async getBranches(e){try{i.logger.info("Getting branches",{filters:e});let r=[(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1)];e.partnerId&&r.push((0,s.eq)(n.branches.partnerId,e.partnerId)),e.search&&r.push((0,s.like)(n.branches.name,`%${e.search}%`));let t=await a.db.select({count:(0,s.count)()}).from(n.branches).where((0,s.and)(...r)),o=t[0]?.count||0,d=await a.db.select({id:n.branches.id,partnerId:n.branches.partnerId,partnerName:n.partners.name,name:n.branches.name,lat:n.branches.lat,lng:n.branches.lng,contactName:n.branches.contactName,phone:n.branches.phone,address:n.branches.address,radiusKm:n.branches.radiusKm,createdAt:n.branches.createdAt,updatedAt:n.branches.updatedAt}).from(n.branches).leftJoin(n.partners,(0,s.eq)(n.branches.partnerId,n.partners.id)).where((0,s.and)(...r)).orderBy("distance"===e.sortBy&&e.lat&&e.lng?s.sql`ST_Distance(ST_Point(${n.branches.lng}, ${n.branches.lat}), ST_Point(${e.lng}, ${e.lat}))`:"asc"===e.sortOrder?(0,s.asc)(n.branches[e.sortBy]):(0,s.desc)(n.branches[e.sortBy])).limit(e.limit).offset((e.page-1)*e.limit),c=[];for(let r of d){let t=await this.getBranchWithDetails(r.id);e.lat&&e.lng&&(t.distance=this.calculateDistance(e.lat,e.lng,parseFloat(r.lat),parseFloat(r.lng))),c.push(t)}return i.logger.info("Branches retrieved successfully",{count:c.length,total:o,filters:e}),{branches:c,total:o}}catch(r){throw i.logger.error("Get branches failed",{error:r instanceof Error?r.message:"Unknown error",filters:e}),r}}async getBranchWithDetails(e){try{let r=await a.db.select({id:n.branches.id,partnerId:n.branches.partnerId,partnerName:n.partners.name,name:n.branches.name,lat:n.branches.lat,lng:n.branches.lng,contactName:n.branches.contactName,phone:n.branches.phone,address:n.branches.address,radiusKm:n.branches.radiusKm,createdAt:n.branches.createdAt,updatedAt:n.branches.updatedAt}).from(n.branches).leftJoin(n.partners,(0,s.eq)(n.branches.partnerId,n.partners.id)).where((0,s.and)((0,s.eq)(n.branches.id,e),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))).limit(1);if(0===r.length)throw new o.AppError("Branch not found",404,o.ErrorCodes.BRANCH_NOT_FOUND);let t=await a.db.select({count:(0,s.count)()}).from(n.branchUsers).where((0,s.and)((0,s.eq)(n.branchUsers.branchId,e),(0,s.eq)(n.branchUsers.isActive,!0),(0,s.eq)(n.branchUsers.isDeleted,!1))),i=await a.db.select({count:(0,s.count)()}).from(n.requests).where((0,s.and)((0,s.eq)(n.requests.branchId,e),(0,s.eq)(n.requests.isActive,!0),(0,s.eq)(n.requests.isDeleted,!1)));return{id:r[0].id,partnerId:r[0].partnerId,partnerName:r[0].partnerName||"",name:r[0].name,lat:parseFloat(r[0].lat||"0"),lng:parseFloat(r[0].lng||"0"),contactName:r[0].contactName||void 0,phone:r[0].phone||void 0,address:r[0].address||void 0,radiusKm:parseFloat(r[0].radiusKm||"10"),createdAt:r[0].createdAt,updatedAt:r[0].updatedAt,usersCount:t[0]?.count||0,requestsCount:i[0]?.count||0}}catch(r){throw i.logger.error("Get branch with details failed",{error:r instanceof Error?r.message:"Unknown error",branchId:e}),r}}async findNearestBranch(e,r,t,o){try{i.logger.info("Finding nearest branch",{lat:e,lng:r,categoryId:t,partnerId:o});let d=[(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1)];o&&d.push((0,s.eq)(n.branches.partnerId,o)),t&&d.push(s.sql`${n.branches.partnerId} IN (SELECT partner_id FROM partner_categories WHERE category_id = ${t} AND is_active = true AND is_deleted = false)`);let c=await a.db.select({id:n.branches.id,partnerId:n.branches.partnerId,partnerName:n.partners.name,name:n.branches.name,lat:n.branches.lat,lng:n.branches.lng,contactName:n.branches.contactName,phone:n.branches.phone,address:n.branches.address,radiusKm:n.branches.radiusKm,createdAt:n.branches.createdAt,updatedAt:n.branches.updatedAt,distance:s.sql`ST_Distance(ST_Point(${n.branches.lng}, ${n.branches.lat}), ST_Point(${r}, ${e})) / 1000`}).from(n.branches).leftJoin(n.partners,(0,s.eq)(n.branches.partnerId,n.partners.id)).where((0,s.and)(...d)).orderBy(s.sql`ST_Distance(ST_Point(${n.branches.lng}, ${n.branches.lat}), ST_Point(${r}, ${e}))`);if(0===c.length)return null;let p=c[0],l=p.distance||0,u=parseFloat(p.radiusKm||"10");if(l>u)return i.logger.info("Nearest branch is outside service radius",{branchId:p.id,distance:l,serviceRadius:u}),null;let h={id:p.id,partnerId:p.partnerId,partnerName:p.partnerName||"",name:p.name,lat:parseFloat(p.lat||"0"),lng:parseFloat(p.lng||"0"),contactName:p.contactName||void 0,phone:p.phone||void 0,address:p.address||void 0,radiusKm:parseFloat(p.radiusKm||"10"),createdAt:p.createdAt,updatedAt:p.updatedAt,usersCount:0,requestsCount:0,distance:l};return i.logger.info("Nearest branch found",{branchId:p.id,distance:l,serviceRadius:u}),{branch:h,distance:l}}catch(t){throw i.logger.error("Find nearest branch failed",{error:t instanceof Error?t.message:"Unknown error",lat:e,lng:r}),t}}async assignBranchUser(e,r){try{i.logger.info("Assigning user to branch",{branchId:e.branchId,userId:e.userId,assignedById:r});let t=await a.db.select().from(n.branches).where((0,s.and)((0,s.eq)(n.branches.id,e.branchId),(0,s.eq)(n.branches.isActive,!0),(0,s.eq)(n.branches.isDeleted,!1))).limit(1);if(0===t.length)throw new o.AppError("Branch not found",404,o.ErrorCodes.BRANCH_NOT_FOUND);let d=await a.db.select().from(n.users).where((0,s.and)((0,s.eq)(n.users.id,e.userId),s.sql`${n.users.userType} = 'partner'::user_type_enum`,(0,s.eq)(n.users.isActive,!0),(0,s.eq)(n.users.isDeleted,!1))).limit(1);if(0===d.length)throw new o.AppError("User not found or not a partner user",404,o.ErrorCodes.USER_NOT_FOUND);if((await a.db.select().from(n.branchUsers).where((0,s.and)((0,s.eq)(n.branchUsers.branchId,e.branchId),(0,s.eq)(n.branchUsers.userId,e.userId),(0,s.eq)(n.branchUsers.isActive,!0),(0,s.eq)(n.branchUsers.isDeleted,!1))).limit(1)).length>0)throw new o.AppError("User is already assigned to this branch",400,o.ErrorCodes.DUPLICATE_ENTRY);await a.db.insert(n.branchUsers).values({...e,assignedById:r}),i.logger.info("User assigned to branch successfully",{branchId:e.branchId,userId:e.userId})}catch(r){throw i.logger.error("Assign branch user failed",{error:r instanceof Error?r.message:"Unknown error",data:e}),r}}async assignPartnerCategory(e,r){try{i.logger.info("Assigning category to partner",{partnerId:e.partnerId,categoryId:e.categoryId,assignedById:r});let t=await a.db.select().from(n.partners).where((0,s.and)((0,s.eq)(n.partners.id,e.partnerId),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).limit(1);if(0===t.length)throw new o.AppError("Partner not found",404,o.ErrorCodes.PARTNER_NOT_FOUND);let d=await a.db.select().from(n.categories).where((0,s.and)((0,s.eq)(n.categories.id,e.categoryId),(0,s.eq)(n.categories.isActive,!0),(0,s.eq)(n.categories.isDeleted,!1))).limit(1);if(0===d.length)throw new o.AppError("Category not found",404,o.ErrorCodes.CATEGORY_NOT_FOUND);if((await a.db.select().from(n.partnerCategories).where((0,s.and)((0,s.eq)(n.partnerCategories.partnerId,e.partnerId),(0,s.eq)(n.partnerCategories.categoryId,e.categoryId),(0,s.eq)(n.partnerCategories.isActive,!0),(0,s.eq)(n.partnerCategories.isDeleted,!1))).limit(1)).length>0)throw new o.AppError("Category is already assigned to this partner",400,o.ErrorCodes.DUPLICATE_ENTRY);await a.db.insert(n.partnerCategories).values({...e,createdById:r}),i.logger.info("Category assigned to partner successfully",{partnerId:e.partnerId,categoryId:e.categoryId})}catch(r){throw i.logger.error("Assign partner category failed",{error:r instanceof Error?r.message:"Unknown error",data:e}),r}}async assignPartnerPickupOption(e,r){try{i.logger.info("Assigning pickup option to partner",{partnerId:e.partnerId,pickupOptionTypeId:e.pickupOptionTypeId,assignedById:r});let t=await a.db.select().from(n.partners).where((0,s.and)((0,s.eq)(n.partners.id,e.partnerId),(0,s.eq)(n.partners.isActive,!0),(0,s.eq)(n.partners.isDeleted,!1))).limit(1);if(0===t.length)throw new o.AppError("Partner not found",404,o.ErrorCodes.PARTNER_NOT_FOUND);let d=await a.db.select().from(n.pickupOptionTypes).where((0,s.and)((0,s.eq)(n.pickupOptionTypes.id,e.pickupOptionTypeId),(0,s.eq)(n.pickupOptionTypes.isActive,!0),(0,s.eq)(n.pickupOptionTypes.isDeleted,!1))).limit(1);if(0===d.length)throw new o.AppError("Pickup option type not found",404,o.ErrorCodes.SERVICE_NOT_FOUND);if((await a.db.select().from(n.partnerPickupOptions).where((0,s.and)((0,s.eq)(n.partnerPickupOptions.partnerId,e.partnerId),(0,s.eq)(n.partnerPickupOptions.pickupOptionTypeId,e.pickupOptionTypeId),(0,s.eq)(n.partnerPickupOptions.isActive,!0),(0,s.eq)(n.partnerPickupOptions.isDeleted,!1))).limit(1)).length>0)throw new o.AppError("Pickup option is already assigned to this partner",400,o.ErrorCodes.DUPLICATE_ENTRY);await a.db.insert(n.partnerPickupOptions).values({...e,createdById:r}),i.logger.info("Pickup option assigned to partner successfully",{partnerId:e.partnerId,pickupOptionTypeId:e.pickupOptionTypeId})}catch(r){throw i.logger.error("Assign partner pickup option failed",{error:r instanceof Error?r.message:"Unknown error",data:e}),r}}calculateDistance(e,r,t,a){let n=this.toRadians(t-e),s=this.toRadians(a-r),o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(t))*Math.sin(s/2)*Math.sin(s/2),i=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return 6371*i}toRadians(e){return Math.PI/180*e}};e.s(["partnerService",0,p]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_lib_services_partnerService_ts_4fedf12f._.js.map