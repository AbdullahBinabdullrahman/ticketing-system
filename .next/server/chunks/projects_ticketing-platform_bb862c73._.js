module.exports=[39239,e=>e.a(async(t,r)=>{try{var s=e.i(88707),a=e.i(78156),n=e.i(89722),i=e.i(11797),o=e.i(29229),l=e.i(3781),u=e.i(85278),d=t([s,a,n,i,o,u]);async function c(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r,d=process.env.JWT_SECRET,c=e.headers["x-test-secret"];if(!d)return l.logger.error("JWT_SECRET not configured in environment"),(0,u.sendErrorResponse)(t,{message:"Server configuration error",code:"CONFIGURATION_ERROR",statusCode:500});if(!c||c!==d)return l.logger.warn("Unauthorized test token request - invalid secret",{ip:e.headers["x-forwarded-for"]||e.socket.remoteAddress}),(0,u.sendErrorResponse)(t,{message:"Unauthorized - Invalid secret key",code:"UNAUTHORIZED",statusCode:401});let p="test.customer@example.com",m=await s.db.select().from(a.users).where((0,n.and)((0,n.eq)(a.users.email,p),(0,n.eq)(a.users.isDeleted,!1))).limit(1);if(0===m.length){l.logger.info("Creating test customer user");let e=await o.default.hash("TestCustomer123!",12);r=(await s.db.insert(a.users).values({name:"Test Customer",email:p,phone:"+966500000000",password:e,userType:"customer",roleId:null,partnerId:null,languagePreference:"en",isActive:!0,isDeleted:!1,emailVerifiedAt:new Date,createdAt:new Date,updatedAt:new Date}).returning())[0].id,l.logger.info("Test customer created",{customerId:r})}else r=m[0].id,l.logger.info("Using existing test customer",{customerId:r});if(r){let e=await i.authService.generateTokens(r);return l.logger.info("Test customer token generated",{customerId:r}),(0,u.sendSuccessResponse)(t,{token:e.accessToken,refreshToken:e.refreshToken,user:{id:r,name:"Test Customer",email:p,userType:"customer"},message:"Test customer token generated. This is for TESTING purposes only."})}}catch(r){let e=(0,u.handleApiError)(r);return l.logger.error("Failed to generate test customer token",{error:e.message}),(0,u.sendErrorResponse)(t,e)}}[s,a,n,i,o,u]=d.then?(await d)():d,e.s(["default",()=>c]),r()}catch(e){r(e)}},!1),80718,e=>e.a(async(t,r)=>{try{var s=e.i(89304),a=e.i(36438),n=e.i(90950),i=e.i(17885),o=e.i(39239),l=e.i(8911),u=e.i(95011),d=e.i(40430),c=t([o]);[o]=c.then?(await c)():c;let m=(0,i.hoist)(o,"default"),g=(0,i.hoist)(o,"config"),h=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/customer/test-token",pathname:"/api/customer/test-token",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,r){h.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/customer/test-token";a=a.replace(/\/index$/,"")||"/";let n=await h.prepare(e,t,{srcPage:a});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:o,prerenderManifest:c,routerServerContext:p}=n;try{let r=e.method||"GET",s=(0,l.getTracer)(),n=s.getActiveScopeSpan(),d=h.instrumentationOnRequestError.bind(h),m=async n=>h.render(e,t,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:h.isDev,page:"/api/customer/test-token",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${r} ${i}`;n.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${a}`)});n?await m(n):await s.withPropagatedContext(e.headers,()=>s.trace(u.BaseServerSpan.handleRequest,{spanName:`${r} ${a}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(h.isDev)throw e;(0,s.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,g,"default",0,m,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_bb862c73._.js.map