module.exports=[82280,e=>e.a(async(t,r)=>{try{var a=e.i(29229),n=e.i(88707),s=e.i(78156),i=e.i(89722),o=e.i(56732),d=e.i(3781),l=t([a,n,s,i]);async function u(e){try{let t=await n.db.select().from(s.partners).where((0,i.and)((0,i.eq)(s.partners.id,e.partnerId),(0,i.eq)(s.partners.isActive,!0),(0,i.eq)(s.partners.isDeleted,!1))).limit(1);if(0===t.length)return{success:!1,error:"Partner not found or inactive"};if((await n.db.select().from(s.users).where((0,i.and)((0,i.eq)(s.users.email,e.email),(0,i.eq)(s.users.isDeleted,!1))).limit(1)).length>0)return{success:!1,error:"Email already exists"};let r=await n.db.select().from(s.roles).where((0,i.eq)(s.roles.name,"partner")).limit(1);if(0===r.length)return{success:!1,error:"Partner role not found"};let l=e.password||function(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*",t="";t+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(26*Math.random())],t+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())],t+="0123456789"[Math.floor(10*Math.random())],t+="!@#$%^&*"[Math.floor(8*Math.random())];for(let r=t.length;r<12;r++)t+=e[Math.floor(Math.random()*e.length)];return t.split("").sort(()=>Math.random()-.5).join("")}(),u=await a.default.hash(l,12),m=!e.password,c=await n.db.insert(s.users).values({name:e.name,email:e.email,phone:e.phone||null,password:u,roleId:r[0].id,userType:"partner",partnerId:e.partnerId,languagePreference:e.language||"en",isActive:!0,isDeleted:!1,emailVerifiedAt:new Date,createdAt:new Date}).returning();if(!1!==e.sendWelcomeEmail&&m)try{await o.default.sendWelcomeEmail(e.email,e.name,l,e.language||"en"),d.logger.info("Welcome email sent",{email:e.email,userId:c[0].id})}catch(t){d.logger.error("Failed to send welcome email",{error:t,email:e.email})}return d.logger.info("Partner user created",{userId:c[0].id,email:e.email,partnerId:e.partnerId,passwordProvided:!m}),{success:!0,user:{id:c[0].id,name:c[0].name,email:c[0].email,phone:c[0].phone,partnerId:c[0].partnerId,languagePreference:c[0].languagePreference,createdAt:c[0].createdAt},password:l,temporaryPassword:m?l:void 0}}catch(t){return d.logger.error("Error creating partner user",{error:t,input:e}),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}[a,n,s,i]=l.then?(await l)():l,e.s(["createPartnerUser",()=>u]),r()}catch(e){r(e)}},!1),95862,e=>e.a(async(t,r)=>{try{var a=e.i(97010),n=t([a]);[a]=n.then?(await n)():n;let s=a.z.object({name:a.z.string().min(2,"Partner name must be at least 2 characters"),contactEmail:a.z.string().email("Invalid email address").optional(),contactPhone:a.z.string().min(10,"Phone number must be at least 10 characters").optional(),logoUrl:a.z.string().url("Invalid logo URL").optional(),status:a.z.enum(["active","inactive","suspended"]).default("active")});s.extend({userName:a.z.string().min(2,"User name must be at least 2 characters"),userEmail:a.z.string().email("Invalid email address"),userPhone:a.z.string().min(10,"Phone must be at least 10 characters"),userPassword:a.z.string().min(8,"Password must be at least 8 characters").optional(),sendWelcomeEmail:a.z.boolean().default(!0)});let i=s.partial(),o=a.z.object({partnerId:a.z.number().int().positive("Partner ID must be positive"),name:a.z.string().min(2,"Branch name must be at least 2 characters"),lat:a.z.number().min(-90).max(90,"Latitude must be between -90 and 90"),lng:a.z.number().min(-180).max(180,"Longitude must be between -180 and 180"),contactName:a.z.string().min(2,"Contact name must be at least 2 characters"),phone:a.z.string().min(10,"Phone number must be at least 10 characters"),address:a.z.string().min(5,"Address must be at least 5 characters"),radiusKm:a.z.number().min(.1).max(100,"Radius must be between 0.1 and 100 km").default(10)});o.partial().omit({partnerId:!0}),a.z.object({branchId:a.z.number().int().positive("Branch ID must be positive"),userId:a.z.number().int().positive("User ID must be positive"),role:a.z.enum(["branch_manager","technician","viewer","admin"]).default("viewer")}),a.z.object({partnerId:a.z.number().int().positive("Partner ID must be positive"),categoryId:a.z.number().int().positive("Category ID must be positive")}),a.z.object({partnerId:a.z.number().int().positive("Partner ID must be positive"),pickupOptionTypeId:a.z.number().int().positive("Pickup option type ID must be positive")});let d=a.z.preprocess(e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?void 0:t},a.z.number().optional()),l=a.z.preprocess(e=>{if(null==e||""===e)return 1;let t=Number(e);return isNaN(t)?1:t},a.z.number()),u=a.z.object({status:a.z.enum(["active","inactive","suspended"]).optional(),categoryId:d.refine(e=>void 0===e||e>0,{message:"Category ID must be positive"}),search:a.z.string().optional(),includeBranches:a.z.preprocess(e=>"true"===e,a.z.boolean().optional()),page:l.refine(e=>e>=1,{message:"Page must be at least 1"}),limit:l.refine(e=>e>=1&&e<=1e3,{message:"Limit must be between 1 and 1000"}),sortBy:a.z.enum(["name","createdAt","updatedAt"]).default("name"),sortOrder:a.z.enum(["asc","desc"]).default("asc")}),m=a.z.object({partnerId:d.refine(e=>void 0===e||e>0,{message:"Partner ID must be positive"}),isActive:a.z.preprocess(e=>"true"===e||"false"!==e&&void 0,a.z.boolean().optional()),search:a.z.string().optional(),lat:a.z.preprocess(e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?void 0:t},a.z.number().optional()),lng:a.z.preprocess(e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?void 0:t},a.z.number().optional()),radiusKm:a.z.preprocess(e=>{if(null==e||""===e)return 10;let t=Number(e);return isNaN(t)?10:t},a.z.number().min(.1).max(100)),page:l.refine(e=>e>=1,{message:"Page must be at least 1"}),limit:l.refine(e=>e>=1&&e<=1e3,{message:"Limit must be between 1 and 1000"}),sortBy:a.z.enum(["name","distance","createdAt"]).default("name"),sortOrder:a.z.enum(["asc","desc"]).default("asc")});e.s(["branchFiltersSchema",0,m,"createBranchSchema",0,o,"createPartnerSchema",0,s,"partnerFiltersSchema",0,u,"updatePartnerSchema",0,i]),r()}catch(e){r(e)}},!1),38436,e=>e.a(async(t,r)=>{try{var a=e.i(95862),n=e.i(18879),s=e.i(11797),i=e.i(85278),o=e.i(3781),d=t([a,n,s,i]);async function l(e,t){if("GET"!==e.method&&"PATCH"!==e.method&&"DELETE"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return(0,i.sendErrorResponse)(t,{message:"Authorization header missing or invalid",code:"AUTHENTICATION_ERROR",statusCode:401});let d=r.substring(7),{userId:l}=await s.authService.verifyToken(d),u=await s.authService.getUserProfile(l);if("admin"!==u.userType)return(0,i.sendErrorResponse)(t,{message:"Access denied - Admin required",code:"AUTHORIZATION_ERROR",statusCode:403});let m=parseInt(e.query.id);if(isNaN(m))return(0,i.sendErrorResponse)(t,{message:"Invalid partner ID",code:"VALIDATION_ERROR",statusCode:400});if(o.logger.apiRequest(e.method,e.url,{userId:l},void 0,e.headers["x-request-id"]),"GET"===e.method){let r="branches"===e.query.include,a=await n.partnerService.getPartnerWithDetails(m,r);return o.logger.apiResponse(e.method,e.url,200,0,l,e.headers["x-request-id"]),(0,i.sendSuccessResponse)(t,a)}if("PATCH"===e.method){let r=a.updatePartnerSchema.parse(e.body),s=await n.partnerService.updatePartner(m,r,l);return o.logger.apiResponse(e.method,e.url,200,0,l,e.headers["x-request-id"]),(0,i.sendSuccessResponse)(t,s)}if("DELETE"===e.method)return await n.partnerService.deletePartner(m,l),o.logger.apiResponse(e.method,e.url,200,0,l,e.headers["x-request-id"]),(0,i.sendSuccessResponse)(t,{message:"Partner deleted successfully"})}catch(a){let r=(0,i.handleApiError)(a);return o.logger.error("Admin partner detail API error",{error:r.message,code:r.code,requestId:e.headers["x-request-id"]}),(0,i.sendErrorResponse)(t,r)}}[a,n,s,i]=d.then?(await d)():d,e.s(["default",()=>l]),r()}catch(e){r(e)}},!1),24082,e=>e.a(async(t,r)=>{try{var a=e.i(89304),n=e.i(36438),s=e.i(90950),i=e.i(17885),o=e.i(38436),d=e.i(8911),l=e.i(95011),u=e.i(40430),m=t([o]);[o]=m.then?(await m)():m;let p=(0,i.hoist)(o,"default"),h=(0,i.hoist)(o,"config"),g=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/admin/partners/[id]",pathname:"/api/admin/partners/[id]",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function c(e,t,r){g.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/admin/partners/[id]";n=n.replace(/\/index$/,"")||"/";let s=await g.prepare(e,t,{srcPage:n});if(!s){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:o,prerenderManifest:m,routerServerContext:c}=s;try{let r=e.method||"GET",a=(0,d.getTracer)(),s=a.getActiveScopeSpan(),u=g.instrumentationOnRequestError.bind(g),p=async s=>g.render(e,t,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:m.preview,propagateError:!1,dev:g.isDev,page:"/api/admin/partners/[id]",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=a.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${r} ${i}`;s.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),s.updateName(e)}else s.updateName(`${r} ${n}`)});s?await p(s):await a.withPropagatedContext(e.headers,()=>a.trace(l.BaseServerSpan.handleRequest,{spanName:`${r} ${n}`,kind:d.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},p))}catch(e){if(g.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,h,"default",0,p,"handler",()=>c]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=projects_ticketing-platform_82be47c2._.js.map